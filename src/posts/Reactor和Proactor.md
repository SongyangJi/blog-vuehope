---
title: Reactor模式和Proactor模式
date: 2021-11-30 09:19:26
categories: 设计模式
tags:
---

Reactor 模式也叫 Dispatcher 模式，我觉得这个名字更贴合该模式的含义，即 **I/O** 多路复⽤监
听事件，收到事件后，根据事件类型分配（**Dispatch**）给某个进程/线程。

Reactor 模式主要由 **Reactor** 和**处理资源池**这两个核⼼部分组成，它俩负责的事情如下：
1. **Reactor 负责监听和分发事件，事件类型包含连接事件、读写事件**；
2. **处理资源池负责处理事件，如 read -> 业务逻辑 -> send**；

Reactor 模式是灵活多变的，可以应对不同的业务场景，灵活在于：
1. Reactor 的数量可以只有⼀个，也可以有多个；
2. 处理资源池可以是单个进程 / 线程，也可以是多个进程 /线程；

将上⾯的两个因素排列组设⼀下，理论上就可以有 4 种⽅案选择：
1. 单 Reactor 单进程 / 线程；
2. 单 Reactor 多进程 / 线程；
3. 多 Reactor 单进程 / 线程；
4. 多 Reactor 多进程 / 线程；

其中，「多 Reactor 单进程 / 线程」实现⽅案相⽐「单 Reactor 单进程 / 线程」⽅案，不仅复杂⽽且也没有性能优势，因此实际中并没有应⽤。

剩下的 3 个⽅案都是⽐较经典的，且都有应⽤在实际的项⽬中：
单 Reactor 单进程 / 线程；
单 Reactor 多线程 / 进程；
多 Reactor 多进程 / 线程；( Netty 和 Memcache 都采⽤了「多 Reactor 多线程、「多 Reactor 多进程」⽅案的开源软件是 Nginx)

⽅案具体使⽤进程还是线程，要看使⽤的编程语⾔以及平台有关：

Java 语⾔⼀般使⽤线程，⽐如 Netty;

C 语⾔使⽤进程和线程都可以，例如 Nginx 使⽤的是进程，Memcache 使⽤的是线程。

接下来，分别介绍这三个经典的 Reactor ⽅案。
